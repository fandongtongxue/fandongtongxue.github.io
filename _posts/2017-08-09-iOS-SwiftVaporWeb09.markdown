---
layout:     post
title:      "åŸºäºSwiftçš„Webæ¡†æ¶Vapor2.0æ–‡æ¡£ï¼ˆç¿»è¯‘ï¼‰Routing-Overview"
subtitle:   ""
date: 2017-08-09 21:00:00.000000000 +08:00
author:     "èŒƒä¸œ"
header-img: "img/post-bg-ios9-web.jpg"
catalog:    true
tags:
    - iOS
    - Swift
    - Web
    - Vapor
---
## å‰è¨€
ä¹‹å‰ä¸€ç›´æœ‰åšJavaåå°å¼€å‘çš„å…´è¶£ï¼Œå¯æ˜¯æƒ³åˆ°è¦çœ‹å¥½å¤šçš„Javaæ•™ç¨‹ï¼Œä½œä¸ºä¸€ä¸ªiOSå¼€å‘è€…ï¼Œæˆ‘æ”¾å¼ƒäº†ï¼Œ
åæ¥ä»æœ‹å‹[éŸ©äº‘æ™ºVL](http://www.jianshu.com/u/92f7630a351b)é‚£é‡ŒçŸ¥é“äº†è¿™ä¸ªæ¡†æ¶ï¼Œç«Ÿæ˜¯ç”¨Swiftå†™çš„ï¼Œä¸å¾—ä¸è¯´ï¼Œå®ƒç‡ƒèµ·äº†æˆ‘çš„å…´è¶£ã€‚
[Vapor](http://vapor.codes)æ˜¯ä¸€ä¸ªåŸºäºSwiftå¼€å‘çš„æœåŠ¡ç«¯æ¡†æ¶ï¼Œå¯ä»¥å·¥ä½œäºiOSï¼ŒMac OSï¼ŒUbuntuã€‚
ä¸ºäº†é…åˆSwiftéƒ¨ç½²åˆ°æœåŠ¡å™¨,æˆ‘æŠŠECSçš„æœåŠ¡å™¨ç³»ç»Ÿæ”¹ä¸ºUbuntu16.04ã€‚
> [Vapor 2.0 - æ–‡æ¡£ç›®å½•](http://blog.fandong.me/2017/08/01/iOS-SwiftVaporWeb/)
> ä»¥ä¸‹æ–‡å­—ç¿»è¯‘è‡ª[Vapor Docs/Routing/Package](https://docs.vapor.codes/2.0/routing/overview/)

## åŸºç¡€è·¯ç”±
è·¯ç”±æ˜¯ä¸€ä¸ªç½‘ç»œæ¡†æ¶ä¸­æœ€å…³é”®çš„æ¨¡å—ä¹‹ä¸€ï¼Œè·¯ç”±å†³å®šäº†ä»€ä¹ˆæ ·çš„è¯·æ±‚è·å¾—ä»€ä¹ˆæ ·çš„å“åº”.
Vaporæœ‰å¤§é‡çš„è·¯ç”±åŠŸèƒ½,åŒ…æ‹¬åˆ›å»º,ç»„ç­–ç•¥,å’Œé›†åˆ,åœ¨æœ¬ç« èŠ‚,æˆ‘ä»¬å°†ä»‹ç»è·¯ç”±çš„åŸºç¡€çŸ¥è¯†.
### æ³¨å†Œ
æœ€åŸºæœ¬çš„è·¯ç”±åŒ…å«ä¸€ä¸ªæ–¹æ³•å,è·¯å¾„å’Œé—­åŒ….

```
drop.get("welcome"){ request in
	return "Hello"
}
```
åŒ…å«GET,POST,PUT,PATCH,DELETEå’ŒOPTIONçš„HTTPæ ‡å‡†æ–¹æ³•éƒ½æ˜¯å¯ç”¨çš„

```
drop.post("form"){ request in
	return "Submitted with a POST request"
}
```
### åµŒå¥—
è¦åœ¨è·¯å¾„ä¸Šè¿›è¡ŒåµŒå¥—(URLä¸­çš„```/```),åªéœ€è¦æ·»åŠ é€—å·

```
drop.get("foo","bar","baz"){ request in
	return "You requested /foo/bar/baz"
}
```
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨```/```,ä½†æ˜¯é€šè¿‡å®‰å…¨è·¯ç”±å‚æ•°ç±»å‹,é€—å·æ¯”è¾ƒå®¹æ˜“è¾“å…¥,æå‡ä½ çš„å·¥ä½œæ•ˆç‡.
### æ›¿ä»£
æ¥å—ä¸€ä¸ªæ–¹æ³•ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„å¤‡ç”¨è¯­æ³•ä¹Ÿæ˜¯å¯ç”¨çš„.

```
drop.add(.trace,"welcome"){ request in
	return "Hello"
}
```
å¦‚æœä½ è¦åŠ¨æ€åœ°æ³¨å†Œè·¯ç”±æˆ–è€…ä½¿ç”¨ä¸€ä¸ªä¸å¤§å¸¸ç”¨çš„æ–¹æ³•å¯èƒ½å¾ˆæœ‰ç”¨.
### è¯·æ±‚
æ¯ä¸€ä¸ªè·¯ç”±é—­åŒ…ä»£è¡¨ä¸€ä¸ªè¯·æ±‚,è¿™åŒ…å«æ‰€æœ‰è°ƒç”¨è·¯ç”±é—­åŒ…è¯·æ±‚ç›¸å…³è”çš„æ•°æ®;
### å“åº”æœºåˆ¶
è·¯ç”±é—­åŒ…å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼è¿”å›
 - å“åº”
 - å“åº”æœºåˆ¶
 - æŠ›å‡ºå¼‚å¸¸
### å“åº”
å¯ä»¥è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„å“åº”

```
drop.get("vapor"){ request in
	return Response(redirect:"http://vapor.codes")
}
```
è¿™å¯¹äºåˆ›å»ºç‰¹æ®Šçš„å“åº”(æ¯”å¦‚é‡å®šå‘)éå¸¸æœ‰ç”¨,è¿™å¯¹äºä½ éœ€è¦å‘å“åº”ä¸­æ·»åŠ Cookiesæˆ–è€…å…¶ä»–é¡¹ç›®çš„æƒ…å†µä¹Ÿæ˜¯æœ‰ç”¨çš„
### å“åº”æœºåˆ¶
æ­£å¦‚ä½ åœ¨å‰é¢çœ‹åˆ°çš„ä¾‹å­ä¸€æ ·,è·¯ç”±é—­åŒ…ä¸­å¯ä»¥è¿”å›å­—ç¬¦ä¸²,è¿™æ˜¯å› ä¸ºä»–ä»¬ç¬¦åˆå“åº”æœºåˆ¶
Vaporä¸­çš„å¾ˆå¤šç±»å‹é»˜è®¤éµå¾ªè¿™ä¸ªåè®®,-String-Int-[JSON](https://docs.vapor.codes/2.0/json/package/)-[Model](https://docs.vapor.codes/2.0/fluent/model/)

```
drop.get("json"){ request in
	var json = JSON()
	try json.set("number",123)
	try json.set("text","unicorns")
	try json.set("bool",false)
	return json
}
```
### æŠ›å‡ºå¼‚å¸¸
å¦‚æœä½ æ— æ³•è¿”å›å“åº”,ä½ å¯ä»¥æŠ›å‡ºä»»ä½•éµå¾ª```Error```çš„å¯¹è±¡,Vapoå¸¦æœ‰é»˜è®¤çš„é”™è¯¯æšä¸¾

```
drop.get("404"){ request in
	throw Abort(.noFound)
}
```
ä½ ä¹Ÿå¯ä»¥é€šè¿‡```Abort```æ¥è‡ªå®šä¹‰è¿™äº›é”™è¯¯çš„ä¿¡æ¯

```
drop.get("error"){ request in
	throw Abort(.badRequest,reason:"Sorry ğŸ˜±")
}
```
è¿™äº›é”™è¯¯ä¼šè¢«é”™è¯¯ä¸­é—´ä»¶æ•è·,åœ¨è¿™é‡Œä»–ä»¬è¢«è½¬æˆç±»ä¼¼ä¸‹é¢çš„JSONå“åº”

```
{
	error:true
	message:"<the message>"
}
```
å¦‚æœä½ æƒ³é‡å†™è¿™ä¸ªè¡Œä¸º,ä»```Dropletçš„ä¸­é—´ä»¶```ä¸­ç§»é™¤é”™è¯¯ä¸­é—´ä»¶(key:"error")å¹¶ä¸”åŠ ä¸Šä½ è‡ªå·±çš„
### åå¤‡
åå¤‡è·¯ç”±å…è®¸ä½ åŒ¹é…å¤šå±‚åµŒå¥—/

```
app.get("anything","*"){request in
	return "Match anything after /anything"
}
```
ä¾‹å¦‚,ä¸Šé¢è¿™ä¸ªè·¯ç”±å¯ä»¥åŒ¹é…ä¸‹é¢æ‰€æœ‰çš„è·¯å¾„æˆ–è€…æ›´å¤š

- /anything
- /anything/foo
- /anything/foo/bar
- /anything/foo/bar/baz
- ...